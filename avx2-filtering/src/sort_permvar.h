#ifndef SORT_PERMVAR_H
#define SORT_PERMVAR_H SORT_PERMVAR_H

#include<stdint.h>
#include<immintrin.h>

static const union {
  int32_t i[8];
    __m256i ymm;
} sort_permutations[] = { 
  /* 0000 */ {{ 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, }}, 
  /* 1000 */ {{ 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, }}, 
  /* 0100 */ {{ 0x02, 0x03, 0x00, 0x01, 0x04, 0x05, 0x06, 0x07, }}, 
  /* 1100 */ {{ 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, }}, 
  /* 0010 */ {{ 0x04, 0x05, 0x02, 0x03, 0x00, 0x01, 0x06, 0x07, }}, 
  /* 1010 */ {{ 0x00, 0x01, 0x04, 0x05, 0x02, 0x03, 0x06, 0x07, }}, 
  /* 0110 */ {{ 0x04, 0x05, 0x02, 0x03, 0x00, 0x01, 0x06, 0x07, }}, 
  /* 1110 */ {{ 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, }}, 
  /* 0001 */ {{ 0x06, 0x07, 0x02, 0x03, 0x04, 0x05, 0x00, 0x01, }}, 
  /* 1001 */ {{ 0x00, 0x01, 0x06, 0x07, 0x04, 0x05, 0x02, 0x03, }}, 
  /* 0101 */ {{ 0x06, 0x07, 0x02, 0x03, 0x04, 0x05, 0x00, 0x01, }}, 
  /* 1101 */ {{ 0x00, 0x01, 0x02, 0x03, 0x06, 0x07, 0x04, 0x05, }}, 
  /* 0011 */ {{ 0x06, 0x07, 0x04, 0x05, 0x02, 0x03, 0x00, 0x01, }}, 
  /* 1011 */ {{ 0x00, 0x01, 0x06, 0x07, 0x04, 0x05, 0x02, 0x03, }}, 
  /* 0111 */ {{ 0x06, 0x07, 0x02, 0x03, 0x04, 0x05, 0x00, 0x01, }}, 
  /* 1111 */ {{ 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, }}, 
};
inline void _mm_sort_permvar_pd(__m256d& mm, const uint8_t& mask)
{
    mm = _mm256_castps_pd(
        _mm256_permutevar8x32_ps(
            _mm256_castpd_ps(mm), 
            sort_permutations[mask & 0xF].ymm));
}  
#endif
